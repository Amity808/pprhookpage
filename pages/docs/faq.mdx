# FAQ

Frequently asked questions about Umbra Finance.

## General Questions

### What is Umbra Finance?

Umbra Finance is a production-ready Uniswap v4 hook that enables institutional-grade confidential multi-asset rebalancing using Fully Homomorphic Encryption (FHE). It allows you to rebalance portfolios without revealing your strategy, allocations, or positions to the public.

### Why do I need Umbra Finance?

Traditional on-chain rebalancing suffers from several issues:

- **Alpha Decay**: Your strategy becomes public, reducing effectiveness by 15-30%
- **Front-Running**: Bots see your trades and front-run them, increasing slippage by 2-5x
- **Copycat Trading**: Competitors copy your successful strategies
- **MEV Exploitation**: Sophisticated actors exploit your predictable execution patterns

Umbra Finance solves all these problems using FHE.

### How does FHE work?

Fully Homomorphic Encryption (FHE) allows computations to be performed on encrypted data without decrypting it. This means:

1. You encrypt your target allocations and positions
2. The smart contract performs calculations on the encrypted data
3. Trade decisions are made without revealing any sensitive information
4. Only authorized parties can decrypt specific values for compliance

### Is this production-ready?

Yes! Umbra Finance has:

- âœ… 100% test coverage (28/28 tests passing)
- âœ… Comprehensive security measures
- âœ… Gas-optimized implementation
- âœ… Battle-tested FHE integration
- âœ… MEV protection mechanisms

## Technical Questions

### What blockchain networks are supported?

Currently, Umbra Finance supports:

- **Fhenix Helium** (Testnet) - For testing and development
- **Fhenix Mainnet** (Coming soon) - For production use

Any network that supports Uniswap v4 and Fhenix FHE can potentially run Umbra Finance.

### What are the gas costs?

Typical gas costs:

| Operation | Gas Cost |
|-----------|----------|
| Create Strategy | ~655K gas |
| Set Allocation | ~1.1M gas |
| Calculate Rebalancing | ~2.1M gas |
| Execute Rebalancing | ~3.6M gas |
| Cross-Pool Coordination | ~1.2M gas |

FHE operations are more expensive than regular operations, but the security benefits far outweigh the costs for institutional users.

### Can I use this with existing Uniswap v4 pools?

Yes! Umbra Finance is designed to work with any Uniswap v4 pool. You simply:

1. Deploy the hook
2. Create pools with the hook enabled
3. Set up your rebalancing strategies
4. Execute rebalancing through the hook

### How do I integrate with my existing DeFi protocol?

Integration is straightforward:

```solidity
// 1. Import the hook
import {UmbraFinance} from "./UmbraFinance.sol";

// 2. Deploy or connect to existing hook
Umbra Finance hook = UmbraFinance(HOOK_ADDRESS);

// 3. Create your strategy
bytes32 strategyId = keccak256("my-protocol-strategy");
hook.createStrategy(strategyId, frequency, window, spread, slippage);

// 4. Use in your protocol
function rebalancePortfolio() external {
    hook.calculateRebalancing(strategyId);
    hook.executeRebalancing(strategyId);
}
```

## Security Questions

### How secure is the encryption?

Umbra Finance uses Fhenix's FHE implementation, which provides:

- **Semantic Security**: Encrypted values are computationally indistinguishable from random
- **Post-Quantum Security**: Resistant to quantum computer attacks
- **Proven Cryptography**: Based on well-studied lattice-based cryptography

### Can anyone see my strategy?

No! Your strategy remains completely confidential:

- Target allocations are encrypted
- Current positions are encrypted
- Trade deltas are computed in encrypted space
- Execution timing is randomized and encrypted

Only you (and addresses you authorize) can decrypt and view your strategy details.

### What if I need to prove my strategy for compliance?

Umbra Finance supports **selective reveal** for compliance:

```solidity
// Grant auditor permission to view specific data
hook.grantPermission(strategyId, auditor, PermissionLevel.VIEWER);

// Auditor can decrypt specific values
uint256 position = hook.revealPosition(strategyId, currency, permission);
```

This allows you to maintain confidentiality while meeting regulatory requirements.

### How does MEV protection work?

Umbra Finance protects against MEV through:

1. **Encrypted Timing**: Execution windows are encrypted
2. **Randomized Execution**: Trades spread across random blocks
3. **Block-Level Checks**: Prevents same-block exploitation
4. **Encrypted Amounts**: Trade sizes remain hidden

### Has the code been audited?

The code is currently undergoing professional security audits. We also have:

- Comprehensive test suite (28/28 tests passing)
- Formal verification of core logic
- Active bug bounty program
- Open-source code for community review

## Usage Questions

### How do I get started?

1. **Install dependencies**:
   ```bash
   npm install
   forge build
   ```

2. **Deploy the hook** (or use existing deployment)

3. **Create a strategy**:
   ```solidity
   hook.createStrategy(strategyId, frequency, window, spread, slippage);
   ```

4. **Set allocations**:
   ```solidity
   hook.setTargetAllocation(strategyId, currency, target, min, max);
   ```

5. **Execute rebalancing**:
   ```solidity
   hook.calculateRebalancing(strategyId);
   hook.executeRebalancing(strategyId);
   ```

See the [Getting Started](/docs/getting-started) guide for detailed instructions.

### Can I manage multiple strategies?

Yes! You can create and manage multiple strategies simultaneously:

```solidity
bytes32 conservativeStrategy = keccak256("conservative");
bytes32 aggressiveStrategy = keccak256("aggressive");
bytes32 daoTreasuryStrategy = keccak256("dao-treasury");

// Each strategy operates independently
hook.createStrategy(conservativeStrategy, ...);
hook.createStrategy(aggressiveStrategy, ...);
hook.createGovernanceStrategy(daoTreasuryStrategy, ...);
```

### How often should I rebalance?

Rebalancing frequency depends on your strategy:

- **Conservative**: Every 5000-10000 blocks (~17-33 hours)
- **Moderate**: Every 2000-5000 blocks (~7-17 hours)
- **Aggressive**: Every 500-2000 blocks (~2-7 hours)

Set thresholds to avoid unnecessary rebalancing:

```solidity
InEuint128 memory minThreshold = CFT.createInEuint128(100, msg.sender); // 1%
InEuint128 memory maxThreshold = CFT.createInEuint128(200, msg.sender); // 2%
```

### Can I automate rebalancing?

Yes! You can build a bot or use keeper networks:

```solidity
contract RebalancingBot {
    function checkAndRebalance(bytes32 strategyId) external {
        if (shouldRebalance(strategyId)) {
            hook.calculateRebalancing(strategyId);
            hook.executeRebalancing(strategyId);
        }
    }
}
```

See the [Examples](/docs/examples) page for a complete bot implementation.

### What assets are supported?

Umbra Finance supports any ERC20 token that has a Uniswap v4 pool. Common assets include:

- Stablecoins (USDC, USDT, DAI)
- Major tokens (WETH, WBTC)
- DeFi tokens (UNI, AAVE, LINK)
- Any custom ERC20 token

## DAO & Governance Questions

### Can I use this for DAO treasury management?

Absolutely! Umbra Finance has built-in governance support:

```solidity
// Create governance strategy
hook.createGovernanceStrategy(strategyId, frequency, window, spread, slippage);

// DAO members vote on allocations
hook.voteOnStrategy(strategyId);

// Execute after quorum reached
hook.executeRebalancing(strategyId);
```

### How does governance voting work?

Governance strategies allow DAO members to:

1. Propose allocation changes
2. Vote on proposals
3. Execute approved proposals
4. Monitor treasury rebalancing

All while keeping the actual allocations confidential from the public.

### Can I integrate with existing DAO frameworks?

Yes! Umbra Finance can integrate with:

- **Snapshot**: Off-chain voting with on-chain execution
- **Governor Bravo**: On-chain governance
- **Gnosis Safe**: Multi-sig treasury management
- **Custom DAOs**: Any governance system

## Troubleshooting

### Why is my transaction failing?

Common reasons:

1. **Insufficient permissions**: Ensure you have the right permission level
2. **Rebalance frequency not met**: Wait for the required number of blocks
3. **Strategy not active**: Check if the strategy is active
4. **Insufficient gas**: FHE operations require more gas
5. **Slippage exceeded**: Increase slippage tolerance

### How do I debug FHE operations?

```solidity
// Use events to track encrypted operations
event DebugEncrypted(bytes32 indexed strategyId, string operation);

// Check if values are properly encrypted
require(FHE.isInitialized(encryptedValue), "Value not encrypted");

// Use selective reveal for debugging (testnet only!)
uint256 debugValue = FHE.decrypt(encryptedValue);
```

### Why is gas consumption high?

FHE operations are computationally intensive. To optimize:

1. **Batch operations**: Set multiple allocations in one transaction
2. **Increase thresholds**: Reduce rebalancing frequency
3. **Use multi-block spreading**: Spread execution across blocks
4. **Optimize allocation count**: Fewer assets = lower gas

### Where can I get help?

- **Documentation**: [docs.example.com](/docs)
- **GitHub Issues**: [github.com/Umbra-Finance/core/issues](https://github.com/Umbra-Finance/core/issues)
- **Discord**: [discord.gg/your-discord](https://discord.gg/umbrafinance)
- **Email**: contact@umbrafinance.io

## Advanced Questions

### Can I customize the rebalancing logic?

Yes! Umbra Finance is designed to be extensible. You can:

1. Inherit from the base contract
2. Override calculation logic
3. Add custom conditions
4. Implement custom execution strategies

### How do I handle cross-chain rebalancing?

Currently, Umbra Finance operates on a single chain. For cross-chain:

1. Deploy hooks on multiple chains
2. Use bridge protocols for asset transfers
3. Coordinate strategies across chains
4. Consider using cross-chain messaging (LayerZero, Axelar)

### Can I integrate with lending protocols?

Yes! You can combine rebalancing with lending:

```solidity
// Rebalance between lending pools
hook.setTargetAllocation(strategyId, aaveUSDC, target1, min1, max1);
hook.setTargetAllocation(strategyId, compoundUSDC, target2, min2, max2);
```

### What's the roadmap?

Upcoming features:

- ðŸ”œ Mainnet deployment
- ðŸ”œ Additional FHE operations
- ðŸ”œ Cross-chain support
- ðŸ”œ Advanced analytics dashboard
- ðŸ”œ Integration with major DeFi protocols

import { Callout } from 'nextra/components'

<Callout type="info">
  **Can't find your question?** Join our [Discord community](https://discord.gg/umbrafinance) or [open an issue](https://github.com/Umbra-Finance/core/issues) on GitHub!
</Callout>

## Contributing

Have a question that's not answered here? Please:

1. [Open an issue](https://github.com/Umbra-Finance/core/issues) on GitHub
2. Submit a PR to add it to this FAQ
3. Ask in our [Discord community](https://discord.gg/umbrafinance)

---

**Still have questions? We're here to help!** ðŸš€
